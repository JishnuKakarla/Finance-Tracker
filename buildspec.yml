version: 0.2

phases:
  install:
    commands:
      - echo "Installing Node.js 20.x on Amazon Linux..."
      - curl -sL https://rpm.nodesource.com/setup_20.x | bash -
      - yum install -y nodejs
      - node -v
      - npm -v
      - echo "Installing Java 17 (Corretto)..."
      - yum install -y java-17-amazon-corretto-devel
      - java -version
      - echo "Installing Angular CLI globally..."
      - npm install -g @angular/cli

  pre_build:
    commands:
      - echo "Installing backend dependencies..."
      - cd Finance-Backend
      - chmod +x mvnw
      - ./mvnw clean install -DskipTests
      - cd ../Finance-Frontend
      - echo "Installing frontend dependencies..."
      - npm install
      - cd ..

  build:
    commands:
      - echo "Building Angular app..."
      - cd Finance-Frontend
      - npm run build -- --output-path=../build/frontend
      - cd ../Finance-Backend
      - echo "Building Spring Boot app..."
      - ./mvnw clean package -DskipTests
      - mkdir -p ../build/backend
      - cp target/*.jar ../build/backend/app.jar
      - cd ..

  post_build:
    commands:
      - echo "Build completed successfully."
      - ls -R build

artifacts:
  files:
    - frontend/**
    - backend/app.jar
    - appspec.yml
    - scripts/**
  base-directory: build
